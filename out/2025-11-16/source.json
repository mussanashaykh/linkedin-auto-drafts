{
  "source": "stackoverflow",
  "feed": "https://stackoverflow.com/feeds/tag?tagnames=ssl&sort=newest",
  "domain": "stackoverflow.com",
  "title": "OkHttpClient Client not sending server-name extension in SSL Client handshake",
  "url": "https://stackoverflow.com/questions/79821319/okhttpclient-client-not-sending-server-name-extension-in-ssl-client-handshake",
  "created": "2025-11-16 07:56:35+00:00",
  "text": "<p>I have a Springboot server with two ssl self signed certificates configured for different hostnames. One certificate assigned to hostname <strong>localhost</strong>. Another assigned as fallback, so any hostname other than localhost (IP Address, Machine Name). Server running on port 8443.</p>\n<p>Now I'm making an API call using a sample Java application.</p>\n<ol>\n<li>java.net.http.HttpClient</li>\n<li>OkHttpClient  (Version 5.3.0)</li>\n</ol>\n<p>Both using the same url (https://localhost:8443)</p>\n<p>In Server side I've enabled the debug logs using JVM options (<code>-Djavax.net.debug=ssl,handshake,certpath</code>)</p>\n<p>I noticed a difference in ClientHello Handshake message.<br />\nThe HTTPClient  include server-name extension with <strong>localhost</strong> but, the OkHttpClient doesn't include any such extension.  Because of that HTTPClient API call use the localhost certificate, and OkHttpClient API Call use the fallback certificate.</p>\n<p><strong>HTTPClient Handshake</strong></p>\n<pre><code> &quot;ClientHello&quot;: {\n  &quot;client version&quot;      : &quot;TLSv1.2&quot;,\n  &quot;random&quot;              : &quot;6805BB78FAA40FEE099E5B55919D8C4DC231F2D9B280779E4A6C742DAD1EB5CE&quot;,\n  &quot;session id&quot;          : &quot;310604CA72DA08A86EFCBEE7E53B849FC390CFF12FD42976F295F1B4C77C90F6&quot;,\n  &quot;cipher suites&quot;       : &quot;[TLS_AES_256_GCM_SHA384(0x1302), TLS_AES_128_GCM_SHA256(0x1301), TLS_CHACHA20_POLY1305_SHA256(0x1303), TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384(0xC02C), TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256(0xC02B), TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256(0xCCA9), TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384(0xC030), TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256(0xCCA8), TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256(0xC02F), TLS_DHE_RSA_WITH_AES_256_GCM_SHA384(0x009F), TLS_DHE_RSA_WITH_CHACHA20_POLY1305_SHA256(0xCCAA), TLS_DHE_DSS_WITH_AES_256_GCM_SHA384(0x00A3), TLS_DHE_RSA_WITH_AES_128_GCM_SHA256(0x009E), TLS_DHE_DSS_WITH_AES_128_GCM_SHA256(0x00A2",
  "id": "67bf1ae8f5ef67f433a2f6370c6073c665734f2e"
}