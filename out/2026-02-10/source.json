{
  "source": "stackoverflow",
  "feed": "https://stackoverflow.com/feeds/tag?tagnames=performance&sort=newest",
  "domain": "stackoverflow.com",
  "title": "Apache Flink 1.18 - Best practice for ValueState access: multiple value() calls vs caching in instance variable?",
  "url": "https://stackoverflow.com/questions/79885962/apache-flink-1-18-best-practice-for-valuestate-access-multiple-value-calls",
  "created": "2026-02-09 15:23:29+00:00",
  "text": "<p>I'm working with Apache Flink 1.18 and I have a question about the best practice for accessing <code>ValueState</code> from a performance perspective.</p>\n<p>I have a <code>KeyedProcessFunction</code> that manages device state through a wrapper class. The state is accessed multiple times across different methods, and I'm wondering which approach is more efficient:</p>\n<h2>Option 1: Call value() each time it's needed</h2>\n<pre class=\"lang-java prettyprint-override\"><code>public class DeviceStateManager {\n    private final ValueState&lt;DeviceData&gt; deviceState;\n    \n    public DeviceStateManager(ValueState&lt;DeviceData&gt; deviceState) {\n        this.deviceState = deviceState;\n    }\n    \n    public void updateMetrics(Measurement measurement) throws Exception {\n        if (deviceState.value() != null) {\n            DeviceData data = deviceState.value();\n            data.addMeasurement(measurement);\n            deviceState.update(data);\n        }\n    }\n    \n    public boolean isAnomalyDetected(double threshold) throws Exception {\n        return deviceState.value() != null &amp;&amp; \n               deviceState.value().getAverage() &gt; threshold;\n    }\n    \n    public Alert generateAlert() throws Exception {\n        if (deviceState.value() == null) return null;\n        return new Alert(\n            deviceState.value().getDeviceId(),\n            deviceState.value().getLastValue(),\n            deviceState.value().getTimestamp()\n        );\n    }\n}\n\npublic class IoTProcessFunction extends KeyedProcessFunction&lt;String, Event, Alert&gt; {\n    private ValueStateDescriptor&lt;DeviceData&gt; stateDescriptor;\n    private transient DeviceStateManager stateManager;\n    \n    @Override\n    public void open(Configuration parameters) {\n        stateDescriptor = new ValueStateDescriptor&lt;&gt;(&quot;device-state&quot;, DeviceData.class);\n    }\n    \n    @Override\n    public void processElement(Event event, Context ctx, Collector&lt;Alert&gt; out) throws Exception {\n        stat",
  "id": "7abd3002bfb5bbe8fe0cefb98a4ea70eb2caede3"
}